#include "maze.h"
#include <iostream>
#include <map>
#include <windows.h>
using namespace std;

void setColor(int color) {
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), color);
}

Maze::Maze() {
    rows = 0;
    cols = 0;
}

vector<vector<vector<char>>> allMazes =  {
        // Easy Maze
     { {
            {'S','.','2','#','.','.','.','#','.','.'},
            {'#','#','.','#','3','#','.','#','5','.'},
            {'.','.','.','.','#','.','.','.','#','.'},
            {'.','5','#','#','#','2','#','.','#','.'},
            {'.','.','.','3','.','.','.','5','.','.'},
            {'#','2','#','.','#','#','#','.','#','3'},
            {'.','.','.','5','.','3','.','.','.','.'},
            {'.','#','#','#','.','#','2','#','#','.'},
            {'.','2','.','.','.','.','#','.','3','.'},
            {'#','.','#','5','#','.','.','2','#','G'}
        },
          // Hard Maze
  {
            
            {'S','.','2','#','.','.','.','#','3','.','.','.','.','5','#','.','.','2','.'},
            {'#','#','.','#','3','#','2','#','.','5','.','#','.','#','2','.','.','#','3','.'},
            {'.','.','.','.','#','5','.','.','#','.','3','.','2','.','.','.','#','.','.','.'},
            {'.','5','#','#','#','2','#','.','#','3','.','#','.','5','.','.','#','.','.','.'},
            {'.','.','.','3','.','.','2','5','.','.','#','.','.','3','.','2','.','.','.','.'},
            {'#','2','#','.','#','#','#','.','#','3','.','#','#','.','.','#','2','.','.','.'},
            {'.','.','.','5','.','3','.','.','.','2','.','.','#','5','.','.','.','.','.','.'},
            {'.','#','#','#','.','#','2','#','#','.','#','.','.','#','3','.','#','.','.','.'},
            {'.','2','.','.','.','.','#','3','.','.','.','5','.','#','.','.','2','.','.','.'},
            {'#','.','#','5','#','.','.','2','#','.','#','.','.','5','#','.','3','.','.','.'},
            {'.','3','.','#','.','2','.','.','#','5','.','#','.','2','.','#','.','3','.','.'},
            {'.','.','.','5','.','.','.','2','.','.','3','.','#','.','5','.','.','#','.','.'},
            {'.','#','#','2','#','#','.','#','3','.','.','#','.','.','.','2','.','.','.','.'},
            {'.','2','.','.','3','.','5','.','.','.','#','2','.','#','.','.','3','.','.','.'},
            {'#','5','#','.','.','#','2','.','#','3','.','5','.','.','2','#','.','#','.','.'},
            {'.','.','3','.','2','.','.','5','.','.','#','3','.','#','2','.','.','.','.','.'},
            {'.','#','.','#','.','#','2','.','3','.','5','.','#','.','2','#','.','3','.','.'},
            {'.','2','.','.','.','5','.','2','#','.','.','.','3','.','.','5','.','.','.','.'},
            {'#','.','#','3','#','2','.','#','.','.','5','.','#','.','2','.','#','3','.','.'},
            {'.','.','5','.','.','.','3','.','2','#','.','5','.','3','.','.','2','.','G'}
        },
           // Insane Maze
    {
             
            {'S','.','2','#','.','.','3','#','2','.','.','#','5','.','.','.','#','2','.','3','.','.','.','#','2','.','3','.','5'},
            {'#','#','.','#','3','#','2','#','.','5','.','#','.','#','2','.','5','#','3','.','#','2','.','5','#','.','2','.','3'},
            {'.','.','.','.','#','5','.','.','#','.','3','.','2','.','5','.','.','.','#','.','3','.','2','.','#','.','5','.','.'},
            {'.','5','#','#','#','2','#','.','#','3','.','#','.','5','.','2','#','.','#','3','.','#','.','2','.','.','3','.','#'},
            {'.','.','.','3','.','.','2','5','.','.','#','.','.','3','.','2','.','.','.','5','#','.','2','.','.','5','.','.','.'},
            {'#','2','#','.','#','#','#','.','#','3','.','#','#','.','.','#','2','.','.','5','#','.','3','.','2','.','5','#','.'},
            {'.','.','.','5','.','3','.','.','.','2','.','.','#','5','.','.','.','.','2','.','3','.','#','5','.','.','.','2','.'},
            {'.','#','#','#','.','#','2','#','#','.','#','.','.','#','3','.','#','2','#','5','.','3','#','.','2','.','5','#','.'},
            {'.','2','.','.','.','.','#','3','.','.','.','5','.','#','.','.','2','.','.','.','3','.','2','#','.','5','.','.','.'},
            {'#','.','#','5','#','.','.','2','#','.','#','.','.','5','#','.','3','.','2','.','#','3','.','5','.','#','.','2','.'},
            {'.','3','.','#','.','2','.','.','#','5','.','#','.','2','.','#','.','3','.','.','5','.','2','#','3','.','.','2','.'},
            {'.','.','.','5','.','.','.','2','.','.','3','.','#','.','5','.','.','#','2','.','3','.','.','.','#','5','.','3','.'},
            {'.','#','#','2','#','#','.','#','3','.','.','#','.','.','.','2','.','5','#','.','2','.','3','.','5','.','2','.','#'},
            {'.','2','.','.','3','.','5','.','.','.','#','2','.','#','.','.','3','.','2','.','5','.','.','#','3','.','.','5','.'},
            {'#','5','#','.','.','#','2','.','#','3','.','5','.','.','2','#','.','5','.','3','.','#','.','2','.','.','5','.','.'},
            {'.','.','3','.','2','.','.','5','.','.','#','3','.','#','2','.','.','3','.','5','.','.','#','2','.','3','.','.','.'},
            {'.','#','.','#','.','#','2','.','3','.','5','.','#','.','2','#','.','3','.','2','.','5','.','#','3','.','2','.','#'},
            {'.','2','.','.','.','5','.','2','#','.','.','.','3','.','.','5','.','.','2','.','3','#','.','.','5','.','3','.','.'},
            {'#','.','#','3','#','2','.','#','.','.','5','.','#','.','2','.','3','.','5','.','#','.','2','.','5','#','.','3','.'},
            {'.','.','5','.','.','.','3','.','2','#','.','5','.','3','.','.','2','.','.','5','.','3','.','2','#','.','5','.','.'},
            {'.','3','.','2','#','.','5','.','3','.','2','.','.','#','.','5','.','.','3','.','2','#','5','.','3','.','2','.','#'},
            {'.','.','#','.','5','.','2','.','3','#','.','2','.','5','.','#','.','.','2','.','3','.','5','.','2','.','3','.','.'},
            {'#','2','.','3','.','.','5','.','2','.','.','3','.','5','.','2','.','3','.','5','.','.','2','#','3','.','5','.','2'},
            {'.','5','.','2','#','3','.','5','#','.','2','.','3','.','5','#','.','2','.','3','#','5','.','2','.','3','.','5'},
            {'.','2','.','3','.','2','.','.','5','.','3','.','2','#','.','5','.','3','.','2','#','.','5','.','3','.','2','.','3'},
            {'#','.','5','.','3','.','2','.','5','.','.','3','.','2','.','5','#','.','3','.','2','.','5','.','2','.','3','.','#'},
            {'.','3','.','2','.','5','.','3','.','2','.','3','.','5','.','2','.','3','.','5','.','2','.','3','.','5','.','2','.'},
            {'.','2','#','.','3','.','2','#','.','5','.','2','.','3','.','5','.','2','.','3','#','.','5','.','3','.','2','.','5'},
            {'.','5','.','2','.','3','.','5','.','2','.','3','.','5','.','2','.','3','.','5','.','2','.','3','.','5','.','.','G'}
        }
    } };

Maze getMaze(int index) {
    Maze m;
    if(index >= 0 && index < allMazes.size()){
        m.grid = allMazes[index];
        m.rows = allMazes[index].size();
        m.cols = allMazes[index][0].size();
        for(int i=0;i<m.rows;i++){
            for(int j=0;j<m.cols;j++){
                if(m.grid[i][j]=='S') m.start={i,j};
                if(m.grid[i][j]=='G') m.goal={i,j};
            }
        }
    }
    return m;
}

bool Maze::isValid(int x,int y){
    return x>=0 && x<rows && y>=0 && y<cols && grid[x][y]!='#';
}

int Maze::getCost(int x, int y) {
    if (grid[x][y] >= '0' && grid[x][y] <= '9') {
        return grid[x][y] - '0';
    }
    if (grid[x][y] == 'A') return 10;
    return 1; 
}

void Maze::printMazeColored(const vector<pair<int,int>> &path, int pathColor){
    map<pair<int,int>, char> pathMap;
    for(auto p : path) pathMap[p]='x';

    for(int i=0;i<rows;i++){
        for(int j=0;j<cols;j++){
            pair<int,int> p={i,j};
            if(p==start){ setColor(14); cout << 'S'; }          
            else if(p==goal){ setColor(2); cout << 'G'; }      
            else if(grid[i][j]=='#'){ setColor(8); cout << '#'; }
            else if(pathMap.count(p)){ setColor(pathColor); cout << 'x'; } 
            else { setColor(7); cout << grid[i][j]; }
            cout << ' ';
        }
        cout << endl;
    }
    setColor(7);
}
